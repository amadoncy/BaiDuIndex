# -*- coding: utf-8 -*-

# Form implementation generated from reading ui file 'login.ui'
#
# Created by: PyQt5 UI code generator 5.15.11
#
# WARNING: Any manual changes made to this file will be lost when pyuic5 is
# run again.  Do not edit this file unless you know what you are doing.


from PyQt5.QtWidgets import (QWidget, QLineEdit, QPushButton,
                             QCheckBox, QVBoxLayout, QHBoxLayout, QLabel,
                             QMainWindow, QMessageBox, QFrame, QGraphicsDropShadowEffect)
from PyQt5.QtCore import (Qt, QCoreApplication, QMetaObject, QTimer,
                          QPropertyAnimation, QPoint, QEasingCurve, QParallelAnimationGroup)
from PyQt5.QtGui import QFont, QPalette, QBrush, QImage, QIcon, QColor
import os
import logging
from datetime import datetime
from utils.db_utils import DatabaseConnection
from config.user_config import UserConfig
from utils.captcha_utils import CaptchaManager
from gui.main_window import WelcomeWindow


class WelcomeToast(QWidget):
    def __init__(self, parent=None):
        super().__init__(parent)
        self.setWindowFlags(Qt.FramelessWindowHint | Qt.Tool | Qt.WindowStaysOnTopHint)
        self.setAttribute(Qt.WA_TranslucentBackground)
        self.setAttribute(Qt.WA_ShowWithoutActivating)

        # åˆ›å»ºå¤–å±‚å®¹å™¨
        self.container = QFrame(self)
        layout = QVBoxLayout(self)
        layout.setContentsMargins(0, 0, 0, 0)
        layout.addWidget(self.container)

        # åˆ›å»ºå†…å±‚å¸ƒå±€
        inner_layout = QVBoxLayout(self.container)
        inner_layout.setContentsMargins(25, 20, 25, 20)

        # åˆ›å»ºæ¬¢è¿æ ‡ç­¾
        self.welcome_label = QLabel("ğŸ‘‹ æ¬¢è¿å›æ¥")
        self.welcome_label.setAlignment(Qt.AlignCenter)
        self.welcome_label.setFont(QFont("Microsoft YaHei", 20, QFont.Bold))
        self.welcome_label.setStyleSheet("""
            color: white;
            padding: 5px;
        """)
        inner_layout.addWidget(self.welcome_label)

        # åˆ›å»ºç”¨æˆ·åæ ‡ç­¾
        self.username_label = QLabel()
        self.username_label.setAlignment(Qt.AlignCenter)
        self.username_label.setFont(QFont("Microsoft YaHei", 18))
        self.username_label.setStyleSheet("""
            color: rgba(255, 255, 255, 0.9);
            padding: 5px;
        """)
        inner_layout.addWidget(self.username_label)

        # æ·»åŠ åˆ†éš”çº¿
        separator = QFrame()
        separator.setFrameShape(QFrame.HLine)
        separator.setStyleSheet("""
            background-color: rgba(255, 255, 255, 0.3);
            margin: 10px 40px;
        """)
        inner_layout.addWidget(separator)

        # åˆ›å»ºç™»å½•æ—¶é—´æ ‡ç­¾
        self.time_label = QLabel()
        self.time_label.setAlignment(Qt.AlignCenter)
        self.time_label.setFont(QFont("Microsoft YaHei", 12))
        self.time_label.setStyleSheet("""
            color: rgba(255, 255, 255, 0.8);
            padding: 5px;
        """)
        inner_layout.addWidget(self.time_label)

        # è®¾ç½®å®¹å™¨æ ·å¼ - ä½¿ç”¨æ¸å˜èƒŒæ™¯
        self.container.setStyleSheet("""
            QFrame {
                background: qlineargradient(
                    x1: 0, y1: 0, x2: 1, y2: 1,
                    stop: 0 #2962FF,
                    stop: 0.5 #3949AB,
                    stop: 1 #1E88E5
                );
                border-radius: 15px;
                border: 1px solid rgba(255, 255, 255, 0.3);
            }
        """)

        # æ·»åŠ é˜´å½±æ•ˆæœ
        shadow = QGraphicsDropShadowEffect(self)
        shadow.setBlurRadius(20)
        shadow.setColor(QColor(0, 0, 0, 160))
        shadow.setOffset(0, 4)
        self.container.setGraphicsEffect(shadow)

        # åˆå§‹åŒ–åŠ¨ç”»
        self.fade_anim = QPropertyAnimation(self, b"windowOpacity")
        self.fade_anim.setDuration(400)  # ç¨å¾®å»¶é•¿åŠ¨ç”»æ—¶é—´

        # åˆå§‹åŒ–ä½ç½®åŠ¨ç”»
        self.pos_anim = QPropertyAnimation(self, b"pos")
        self.pos_anim.setDuration(400)
        self.pos_anim.setEasingCurve(QEasingCurve.OutBack)  # æ·»åŠ å¼¹æ€§æ•ˆæœ

    def show_message(self, username, last_login):
        # è®¾ç½®æ¶ˆæ¯å†…å®¹
        self.username_label.setText(username)
        self.time_label.setText(f"ä¸Šæ¬¡ç™»å½•æ—¶é—´ï¼š\n{last_login}")

        # è°ƒæ•´å¤§å°ä»¥é€‚åº”å†…å®¹
        self.container.adjustSize()
        self.setFixedSize(350, 220)  # ç¨å¾®å¢åŠ å¤§å°
        self.container.setFixedSize(self.size())

        # è®¡ç®—ä½ç½®
        parent = self.parent()
        if parent:
            parent_rect = parent.geometry()
            target_x = parent_rect.x() + (parent_rect.width() - self.width()) // 2
            target_y = parent_rect.y() + (parent_rect.height() - self.height()) // 2

            # è®¾ç½®åˆå§‹ä½ç½®ï¼ˆä»ä¸Šæ–¹æ»‘å…¥ï¼‰
            start_y = target_y - 50
            self.move(target_x, start_y)

            # è®¾ç½®ä½ç½®åŠ¨ç”»
            self.pos_anim.setStartValue(QPoint(target_x, start_y))
            self.pos_anim.setEndValue(QPoint(target_x, target_y))

        # æ˜¾ç¤ºå¹¶å¼€å§‹åŠ¨ç”»
        self.show()
        self.fade_anim.setStartValue(0.0)
        self.fade_anim.setEndValue(1.0)
        self.fade_anim.start()
        self.pos_anim.start()

        # 2ç§’åå¼€å§‹æ·¡å‡º
        QTimer.singleShot(2000, self.start_fade_out)

    def start_fade_out(self):
        """å¼€å§‹æ·¡å‡ºåŠ¨ç”»"""
        # åˆ›å»ºæ–°çš„åŠ¨ç”»ç»„
        self.anim_group = QParallelAnimationGroup(self)

        # è®¾ç½®æ·¡å‡ºåŠ¨ç”»
        fade_out = QPropertyAnimation(self, b"windowOpacity", self)
        fade_out.setStartValue(1.0)
        fade_out.setEndValue(0.0)
        fade_out.setDuration(400)

        # è®¾ç½®ä¸Šç§»åŠ¨ç”»
        move_up = QPropertyAnimation(self, b"pos", self)
        current_pos = self.pos()
        move_up.setStartValue(current_pos)
        move_up.setEndValue(QPoint(current_pos.x(), current_pos.y() - 50))
        move_up.setDuration(400)
        move_up.setEasingCurve(QEasingCurve.InCubic)

        # æ·»åŠ åŠ¨ç”»åˆ°ç»„
        self.anim_group.addAnimation(fade_out)
        self.anim_group.addAnimation(move_up)

        # åŠ¨ç”»ç»“æŸåå…³é—­çª—å£
        self.anim_group.finished.connect(self.close)

        # å¼€å§‹åŠ¨ç”»ç»„
        self.anim_group.start()


class LoginWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        # è®¾ç½®çª—å£å›¾æ ‡
        icon_path = os.path.join(os.path.dirname(os.path.dirname(__file__)), 'resources', 'logo.png')
        if os.path.exists(icon_path):
            self.setWindowIcon(QIcon(icon_path))
        self.ui = Ui_MainWindow()
        self.ui.setupUi(self)
        self.db = DatabaseConnection()
        self.user_config = UserConfig()
        self.captcha_manager = CaptchaManager()
        self.current_captcha_id = None

        # ç»‘å®šç™»å½•æŒ‰é’®ç‚¹å‡»äº‹ä»¶
        self.ui.pushButton.clicked.connect(self.handle_login)

        # ç»‘å®šéªŒè¯ç åˆ·æ–°æŒ‰é’®äº‹ä»¶
        self.ui.refresh_captcha_btn.clicked.connect(self.refresh_captcha)

        # ç»‘å®šæ³¨å†ŒæŒ‰é’®äº‹ä»¶
        self.ui.register_btn.clicked.connect(self.show_register)

        # ç»‘å®šå¿˜è®°å¯†ç é“¾æ¥äº‹ä»¶
        self.ui.forget_password_link.mousePressEvent = self.show_reset_password

        # åŠ è½½ä¿å­˜çš„ç™»å½•ä¿¡æ¯
        self.load_saved_login_info()

        # ç”Ÿæˆåˆå§‹éªŒè¯ç 
        self.refresh_captcha()

        # å»¶è¿Ÿæ‰§è¡Œè‡ªåŠ¨ç™»å½•
        QTimer.singleShot(1000, self.check_auto_login)

    def check_auto_login(self):
        """æ£€æŸ¥æ˜¯å¦éœ€è¦è‡ªåŠ¨ç™»å½•"""
        if self.ui.checkBox.isChecked() and self.ui.username.text() and self.ui.password.text():
            self.handle_login()

    def refresh_captcha(self):
        """åˆ·æ–°éªŒè¯ç """
        try:
            captcha_id, captcha_image = self.captcha_manager.generate_captcha()
            if captcha_id and captcha_image:
                self.current_captcha_id = captcha_id
                self.ui.captcha_label.setPixmap(captcha_image)
        except Exception as e:
            logging.error(f"åˆ·æ–°éªŒè¯ç å¤±è´¥: {str(e)}")
            QMessageBox.warning(self, "é”™è¯¯", "åˆ·æ–°éªŒè¯ç å¤±è´¥ï¼Œè¯·æ£€æŸ¥RedisæœåŠ¡æ˜¯å¦å¯åŠ¨")

    def load_saved_login_info(self):
        """åŠ è½½ä¿å­˜çš„ç™»å½•ä¿¡æ¯"""
        login_info = self.user_config.get_login_info()

        if login_info['remember_password']:
            self.ui.username.setText(login_info['username'])
            self.ui.password.setText(login_info['password'])
            self.ui.checkBox_2.setChecked(True)

        if login_info['auto_login']:
            self.ui.checkBox.setChecked(True)

    def handle_login(self):
        """å¤„ç†ç™»å½•é€»è¾‘"""
        logging.debug("å¼€å§‹å¤„ç†ç™»å½•è¯·æ±‚...")
        username = self.ui.username.text().strip()
        password = self.ui.password.text().strip()
        captcha = self.ui.yanzhengma.text().strip()

        logging.debug(f"ç”¨æˆ·å: {username}, å¯†ç é•¿åº¦: {len(password)}, éªŒè¯ç : {captcha}")

        if not username or not password:
            logging.warning("ç”¨æˆ·åæˆ–å¯†ç ä¸ºç©º")
            QMessageBox.warning(self, "è­¦å‘Š", "ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©ºï¼")
            return

        if not captcha:
            logging.warning("éªŒè¯ç ä¸ºç©º")
            QMessageBox.warning(self, "è­¦å‘Š", "è¯·è¾“å…¥éªŒè¯ç ï¼")
            return

        # éªŒè¯éªŒè¯ç 
        logging.debug("å¼€å§‹éªŒè¯éªŒè¯ç ...")
        if not self.captcha_manager.verify_captcha(self.current_captcha_id, captcha):
            logging.warning("éªŒè¯ç éªŒè¯å¤±è´¥")
            QMessageBox.warning(self, "é”™è¯¯", "éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸï¼")
            self.refresh_captcha()
            self.ui.yanzhengma.clear()
            return

        # éªŒè¯ç™»å½•
        logging.debug("å¼€å§‹éªŒè¯ç™»å½•ä¿¡æ¯...")
        success, last_login = self.verify_login(username, password)
        if success:
            logging.debug("ç™»å½•æˆåŠŸ")
            # ä¿å­˜ç™»å½•ä¿¡æ¯
            self.save_login_info(username, password)
            logging.debug("å·²ä¿å­˜ç™»å½•ä¿¡æ¯")

            # æ˜¾ç¤ºæ¬¢è¿æç¤º
            toast = WelcomeToast(self)
            last_login_str = last_login.strftime("%Yå¹´%mæœˆ%dæ—¥ %H:%M") if last_login else "é¦–æ¬¡ç™»å½•"
            toast.show_message(username, last_login_str)
            logging.debug("å·²æ˜¾ç¤ºæ¬¢è¿æç¤º")

            # å»¶è¿Ÿæ˜¾ç¤ºä¸»ç•Œé¢
            QTimer.singleShot(2500, lambda: self.show_main_window(username))
            logging.debug("å·²è®¾ç½®å»¶è¿Ÿæ˜¾ç¤ºä¸»ç•Œé¢")
        else:
            logging.warning("ç™»å½•å¤±è´¥ï¼šç”¨æˆ·åæˆ–å¯†ç é”™è¯¯")
            QMessageBox.warning(self, "é”™è¯¯", "ç”¨æˆ·åæˆ–å¯†ç é”™è¯¯ï¼")
            self.refresh_captcha()
            self.ui.yanzhengma.clear()

    def verify_login(self, username, password):
        """éªŒè¯ç™»å½•ä¿¡æ¯"""
        try:
            logging.debug(f"å¼€å§‹éªŒè¯ç™»å½•ä¿¡æ¯ - ç”¨æˆ·å: {username}")

            if not self.db.connect():
                logging.error("æ•°æ®åº“è¿æ¥å¤±è´¥")
                QMessageBox.warning(self, "é”™è¯¯", "æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ï¼")
                return False, None

            logging.debug("æ•°æ®åº“è¿æ¥æˆåŠŸ")

            # è·å–ç”¨æˆ·ä¿¡æ¯å’Œä¸Šæ¬¡ç™»å½•æ—¶é—´
            query = "SELECT id, last_login FROM users WHERE username = %s AND password = %s"
            logging.debug(f"æ‰§è¡ŒæŸ¥è¯¢è¯­å¥: {query}")
            logging.debug(f"æŸ¥è¯¢å‚æ•°: username={username}")

            self.db.cursor.execute(query, (username, password))
            result = self.db.cursor.fetchone()

            if result:
                user_id, last_login = result
                logging.debug(f"æ‰¾åˆ°ç”¨æˆ·è®°å½• - ID: {user_id}, ä¸Šæ¬¡ç™»å½•æ—¶é—´: {last_login}")

                # æ›´æ–°æœ€åç™»å½•æ—¶é—´
                update_query = "UPDATE users SET last_login = NOW() WHERE id = %s"
                logging.debug(f"æ‰§è¡Œæ›´æ–°è¯­å¥: {update_query}, å‚æ•°: id={user_id}")
                self.db.cursor.execute(update_query, (user_id,))
                self.db.connection.commit()
                logging.debug("ç™»å½•æ—¶é—´æ›´æ–°æˆåŠŸ")
                return True, last_login
            else:
                logging.warning("æœªæ‰¾åˆ°åŒ¹é…çš„ç”¨æˆ·è®°å½•")
                # æ£€æŸ¥ç”¨æˆ·æ˜¯å¦å­˜åœ¨
                check_query = "SELECT id FROM users WHERE username = %s"
                self.db.cursor.execute(check_query, (username,))
                if self.db.cursor.fetchone():
                    logging.warning("ç”¨æˆ·åå­˜åœ¨ä½†å¯†ç é”™è¯¯")
                    QMessageBox.warning(self, "é”™è¯¯", "å¯†ç é”™è¯¯ï¼")
                else:
                    logging.warning("ç”¨æˆ·åä¸å­˜åœ¨")
                    QMessageBox.warning(self, "é”™è¯¯", "ç”¨æˆ·åä¸å­˜åœ¨ï¼")
                return False, None

        except Exception as e:
            logging.error(f"ç™»å½•éªŒè¯å¤±è´¥ï¼š{str(e)}")
            QMessageBox.warning(self, "é”™è¯¯", f"ç™»å½•éªŒè¯å¤±è´¥ï¼š{str(e)}\nè¯·ç¨åé‡è¯•ï¼")
            return False, None
        finally:
            logging.debug("å…³é—­æ•°æ®åº“è¿æ¥")
            self.db.close()
        return False, None

    def save_login_info(self, username, password):
        """ä¿å­˜ç™»å½•ä¿¡æ¯"""
        remember_password = self.ui.checkBox_2.isChecked()
        auto_login = self.ui.checkBox.isChecked()

        self.user_config.save_login_info(
            username=username,
            password=password,
            remember_password=remember_password,
            auto_login=auto_login
        )

    def show_register(self):
        """æ˜¾ç¤ºæ³¨å†Œçª—å£"""
        try:
            logging.info("å¼€å§‹åŠ è½½æ³¨å†Œçª—å£...")

            # æ£€æŸ¥register_window.pyæ–‡ä»¶æ˜¯å¦å­˜åœ¨
            register_file = os.path.join(os.path.dirname(__file__), 'register_window.py')
            if not os.path.exists(register_file):
                logging.error(f"æ³¨å†Œçª—å£æ–‡ä»¶ä¸å­˜åœ¨: {register_file}")
                QMessageBox.warning(self, "é”™è¯¯", "æ³¨å†Œçª—å£æ–‡ä»¶ä¸å­˜åœ¨ï¼Œè¯·æ£€æŸ¥ç³»ç»Ÿæ–‡ä»¶æ˜¯å¦å®Œæ•´ï¼")
                return

            # å°è¯•å¯¼å…¥RegisterWindowç±»
            try:
                from gui.register_window import RegisterWindow
                logging.info("æˆåŠŸå¯¼å…¥RegisterWindowç±»")
            except ImportError as e:
                logging.error(f"å¯¼å…¥RegisterWindowå¤±è´¥: {str(e)}")
                QMessageBox.warning(self, "é”™è¯¯", "æ— æ³•åŠ è½½æ³¨å†Œçª—å£ï¼Œè¯·æ£€æŸ¥ç³»ç»Ÿæ–‡ä»¶æ˜¯å¦å®Œæ•´ï¼")
                return

            # åˆ›å»ºæ³¨å†Œçª—å£å®ä¾‹
            try:
                self.register_window = RegisterWindow(self)
                logging.info("æˆåŠŸåˆ›å»ºRegisterWindowå®ä¾‹")
            except Exception as e:
                logging.error(f"åˆ›å»ºRegisterWindowå®ä¾‹å¤±è´¥: {str(e)}")
                QMessageBox.warning(self, "é”™è¯¯", "åˆ›å»ºæ³¨å†Œçª—å£å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ï¼")
                return

            # æ˜¾ç¤ºæ³¨å†Œçª—å£
            try:
                self.register_window.show()
                logging.info("æˆåŠŸæ˜¾ç¤ºæ³¨å†Œçª—å£")
            except Exception as e:
                logging.error(f"æ˜¾ç¤ºæ³¨å†Œçª—å£å¤±è´¥: {str(e)}")
                QMessageBox.warning(self, "é”™è¯¯", "æ˜¾ç¤ºæ³¨å†Œçª—å£å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ï¼")
                return

            # éšè—ç™»å½•çª—å£
            try:
                self.hide()
                logging.info("æˆåŠŸéšè—ç™»å½•çª—å£")
            except Exception as e:
                logging.error(f"éšè—ç™»å½•çª—å£å¤±è´¥: {str(e)}")
                QMessageBox.warning(self, "é”™è¯¯", "åˆ‡æ¢çª—å£å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ï¼")
                return

        except Exception as e:
            logging.error(f"æ‰“å¼€æ³¨å†Œçª—å£æ—¶å‘ç”ŸæœªçŸ¥é”™è¯¯: {str(e)}")
            QMessageBox.warning(self, "é”™è¯¯", f"æ‰“å¼€æ³¨å†Œçª—å£å¤±è´¥ï¼š{str(e)}\nè¯·ç¨åé‡è¯•ï¼")

    def show_reset_password(self, event):
        """æ˜¾ç¤ºæ‰¾å›å¯†ç çª—å£"""
        from gui.reset_password_window import ResetPasswordWindow
        self.reset_window = ResetPasswordWindow(self)
        self.reset_window.show()
        self.hide()

    def show_main_window(self, username):
        """æ˜¾ç¤ºä¸»ç•Œé¢"""
        self.welcome_window = WelcomeWindow(username)
        self.welcome_window.show()
        self.close()


class Ui_MainWindow(object):
    def setupUi(self, MainWindow):
        # è®¾ç½®ä¸»çª—å£
        MainWindow.setObjectName("MainWindow")
        MainWindow.resize(1200, 800)  # å¢åŠ çª—å£å¤§å°
        MainWindow.setWindowTitle("æ¬¢è¿ä½¿ç”¨å…»è€éœ€æ±‚åˆ†æç³»ç»Ÿ")
        MainWindow.setFixedSize(1200, 800)  # å›ºå®šçª—å£å¤§å°

        # åˆ›å»ºä¸­å¤®éƒ¨ä»¶
        self.centralwidget = QWidget(MainWindow)
        MainWindow.setCentralWidget(self.centralwidget)

        # è®¾ç½®èƒŒæ™¯å›¾ç‰‡
        try:
            current_dir = os.path.dirname(os.path.abspath(__file__))
            background_path = os.path.join(os.path.dirname(current_dir), 'resources', 'background.png')
            logging.info(f"åŠ è½½èƒŒæ™¯å›¾ç‰‡: {background_path}")

            if os.path.exists(background_path):
                palette = QPalette()
                image = QImage(background_path)
                if not image.isNull():
                    scaled_image = image.scaled(
                        MainWindow.size(),
                        Qt.KeepAspectRatioByExpanding,
                        Qt.SmoothTransformation
                    )
                    brush = QBrush(scaled_image)
                    palette.setBrush(QPalette.Window, brush)
                    MainWindow.setPalette(palette)
                    logging.info("èƒŒæ™¯å›¾ç‰‡è®¾ç½®æˆåŠŸ")
                else:
                    logging.error("èƒŒæ™¯å›¾ç‰‡åŠ è½½å¤±è´¥")
            else:
                logging.error(f"èƒŒæ™¯å›¾ç‰‡æ–‡ä»¶ä¸å­˜åœ¨: {background_path}")
        except Exception as e:
            logging.error(f"è®¾ç½®èƒŒæ™¯å›¾ç‰‡å¤±è´¥: {str(e)}")

        # åˆ›å»ºä¸€ä¸ªåŠé€æ˜çš„ç™½è‰²é¢æ¿
        self.login_panel = QFrame(self.centralwidget)
        self.login_panel.setGeometry(400, 100, 400, 600)  # è°ƒæ•´ç™»å½•é¢æ¿ä½ç½®å’Œå¤§å°
        self.login_panel.setStyleSheet("""
            QFrame {
                background-color: rgba(255, 255, 255, 200);
                border-radius: 20px;
                border: 2px solid rgba(255, 255, 255, 255);
            }
        """)

        # åˆ›å»ºå‚ç›´å¸ƒå±€
        layout = QVBoxLayout(self.login_panel)
        layout.setSpacing(25)  # å¢åŠ é—´è·
        layout.setContentsMargins(40, 40, 40, 40)  # å¢åŠ è¾¹è·

        # æ ‡é¢˜
        title = QLabel("æ¬¢è¿ä½¿ç”¨å…»è€éœ€æ±‚åˆ†æç³»ç»Ÿ")
        title.setFont(QFont("Microsoft YaHei", 18, QFont.Bold))  # è°ƒæ•´å­—ä½“å¤§å°
        title.setAlignment(Qt.AlignCenter)
        title.setStyleSheet("""
            color: #333333;
            padding: 10px;
            background: none;
            margin: 0;
            white-space: nowrap;  /* ç¦æ­¢æ¢è¡Œ */
        """)
        title.setMinimumWidth(320)  # è®¾ç½®æœ€å°å®½åº¦
        layout.addWidget(title)

        # æ·»åŠ ä¸€äº›ç©ºé—´
        layout.addSpacing(30)

        # ç”¨æˆ·åè¾“å…¥
        self.username = QLineEdit()
        self.username.setPlaceholderText("è¯·è¾“å…¥ç”¨æˆ·å")
        self.username.setFixedHeight(45)  # å¢åŠ è¾“å…¥æ¡†é«˜åº¦
        layout.addWidget(self.username)

        # å¯†ç è¾“å…¥
        self.password = QLineEdit()
        self.password.setPlaceholderText("è¯·è¾“å…¥å¯†ç ")
        self.password.setEchoMode(QLineEdit.Password)
        self.password.setFixedHeight(45)
        layout.addWidget(self.password)

        # éªŒè¯ç å¸ƒå±€
        captcha_layout = QHBoxLayout()
        captcha_layout.setSpacing(5)  # å‡å°ç»„ä»¶é—´è·

        # éªŒè¯ç è¾“å…¥æ¡†
        self.yanzhengma = QLineEdit()
        self.yanzhengma.setPlaceholderText("éªŒè¯ç ")  # ç®€åŒ–æç¤ºæ–‡å­—
        self.yanzhengma.setFixedHeight(45)
        self.yanzhengma.setFixedWidth(80)  # å‡å°è¾“å…¥æ¡†å®½åº¦
        self.yanzhengma.setStyleSheet("""
            QLineEdit {
                padding: 5px;  /* å‡å°å†…è¾¹è· */
                border: 1px solid #ddd;
                border-radius: 4px;
                background-color: white;
                font-size: 14px;
            }
            QLineEdit:focus {
                border: 1px solid #4CAF50;
            }
        """)
        captcha_layout.addWidget(self.yanzhengma)

        # éªŒè¯ç å›¾ç‰‡æ ‡ç­¾
        self.captcha_label = QLabel()
        self.captcha_label.setFixedSize(180, 45)  # è°ƒæ•´éªŒè¯ç å›¾ç‰‡å®½åº¦
        self.captcha_label.setStyleSheet("""
            QLabel {
                border: 1px solid #ddd;
                border-radius: 4px;
                background-color: white;
                padding: 2px;
            }
        """)
        captcha_layout.addWidget(self.captcha_label)

        # åˆ·æ–°éªŒè¯ç æŒ‰é’®
        self.refresh_captcha_btn = QPushButton("åˆ·æ–°")
        self.refresh_captcha_btn.setFixedSize(45, 45)  # è°ƒæ•´åˆ·æ–°æŒ‰é’®ä¸ºæ­£æ–¹å½¢
        self.refresh_captcha_btn.setCursor(Qt.PointingHandCursor)
        self.refresh_captcha_btn.setStyleSheet("""
            QPushButton {
                background-color: #f8f9fa;
                border: 1px solid #ddd;
                border-radius: 4px;
                color: #333;
                font-size: 12px;
                padding: 0px;  /* ç§»é™¤å†…è¾¹è· */
            }
            QPushButton:hover {
                background-color: #e9ecef;
            }
            QPushButton:pressed {
                background-color: #dee2e6;
            }
        """)
        captcha_layout.addWidget(self.refresh_captcha_btn)

        # æ·»åŠ å¼¹æ€§ç©ºé—´ï¼Œç¡®ä¿ç»„ä»¶é å·¦å¯¹é½
        captcha_layout.addStretch()

        layout.addLayout(captcha_layout)

        # å¤é€‰æ¡†å¸ƒå±€
        checkbox_layout = QHBoxLayout()
        checkbox_layout.setAlignment(Qt.AlignCenter)

        # è®°ä½å¯†ç å¤é€‰æ¡†
        self.checkBox_2 = QCheckBox("è®°ä½å¯†ç ")
        self.checkBox_2.setFont(QFont("Microsoft YaHei", 11))
        checkbox_layout.addWidget(self.checkBox_2)

        # æ·»åŠ ä¸€äº›é—´è·
        checkbox_layout.addSpacing(30)

        # è‡ªåŠ¨ç™»å½•å¤é€‰æ¡†
        self.checkBox = QCheckBox("è‡ªåŠ¨ç™»å½•")
        self.checkBox.setFont(QFont("Microsoft YaHei", 11))
        checkbox_layout.addWidget(self.checkBox)

        layout.addLayout(checkbox_layout)

        # å¿˜è®°å¯†ç é“¾æ¥
        self.forget_password_link = QLabel("å¿˜è®°å¯†ç ï¼Ÿ")
        self.forget_password_link.setAlignment(Qt.AlignCenter)
        self.forget_password_link.setStyleSheet("""
            QLabel {
                color: #4CAF50;
                text-decoration: underline;
                cursor: pointer;
            }
            QLabel:hover {
                color: #45a049;
            }
        """)
        self.forget_password_link.setCursor(Qt.PointingHandCursor)
        layout.addWidget(self.forget_password_link)

        # æ·»åŠ ä¸€äº›ç©ºé—´
        layout.addSpacing(10)

        # ç™»å½•æŒ‰é’®å¸ƒå±€
        button_layout = QHBoxLayout()

        # æ³¨å†ŒæŒ‰é’®
        self.register_btn = QPushButton("æ³¨å†Œè´¦å·")
        self.register_btn.setFixedSize(150, 50)
        self.register_btn.setFont(QFont("Microsoft YaHei", 13))
        self.register_btn.setStyleSheet("""
            QPushButton {
                background-color: #6c757d;
                color: white;
                border: none;
                border-radius: 5px;
                font-weight: bold;
            }
            QPushButton:hover {
                background-color: #5a6268;
            }
            QPushButton:pressed {
                background-color: #545b62;
            }
        """)
        button_layout.addWidget(self.register_btn)

        # æ·»åŠ ä¸€äº›é—´è·
        button_layout.addSpacing(20)

        # ç™»å½•æŒ‰é’®
        self.pushButton = QPushButton("ç™» å½•")
        self.pushButton.setFixedSize(150, 50)
        self.pushButton.setFont(QFont("Microsoft YaHei", 13))
        button_layout.addWidget(self.pushButton)

        layout.addLayout(button_layout)

        # è®¾ç½®æ ·å¼
        style = """
            QLineEdit {
                padding: 8px 15px;
                border: 1px solid #ddd;
                border-radius: 5px;
                background-color: white;
                font-size: 14px;
            }
            QLineEdit:focus {
                border: 1px solid #4CAF50;
            }
            QPushButton#pushButton {
                background-color: #4CAF50;
                color: white;
                border: none;
                border-radius: 5px;
                font-weight: bold;
            }
            QPushButton#pushButton:hover {
                background-color: #45a049;
            }
            QPushButton#pushButton:pressed {
                background-color: #3d8b40;
            }
            QCheckBox {
                color: #333;
                spacing: 5px;
            }
            QCheckBox::indicator {
                width: 18px;
                height: 18px;
            }
            QCheckBox::indicator:unchecked {
                border: 2px solid #999;
                border-radius: 3px;
                background-color: white;
            }
            QCheckBox::indicator:checked {
                border: 2px solid #4CAF50;
                border-radius: 3px;
                background-color: #4CAF50;
            }
        """
        MainWindow.setStyleSheet(style)

        QMetaObject.connectSlotsByName(MainWindow)

    def retranslateUi(self, MainWindow):
        _translate = QCoreApplication.translate
        MainWindow.setWindowTitle(_translate("MainWindow", "ç™»å½•"))
        self.username.setPlaceholderText(_translate("MainWindow", "è¯·è¾“å…¥ç”¨æˆ·å"))
        self.password.setPlaceholderText(_translate("MainWindow", "è¯·è¾“å…¥å¯†ç "))
        self.yanzhengma.setPlaceholderText(_translate("MainWindow", "è¯·è¾“å…¥éªŒè¯ç "))
        self.checkBox.setText(_translate("MainWindow", "è‡ªåŠ¨ç™»å½•"))
        self.checkBox_2.setText(_translate("MainWindow", "è®°ä½å¯†ç "))
        self.pushButton.setText(_translate("MainWindow", "ç™» å½•"))


if __name__ == "__main__":
    import sys
    from PyQt5.QtWidgets import QApplication

    app = QApplication(sys.argv)
    window = LoginWindow()
    window.show()
    sys.exit(app.exec_())